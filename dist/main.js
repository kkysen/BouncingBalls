!function(e){var t={};function n(l){if(t[l])return t[l].exports;var r=t[l]={i:l,l:!1,exports:{}};return e[l].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,l){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:l})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathUtils={TAU:2*Math.PI,rad2deg:e=>180*e/Math.PI,deg2rad:e=>e*Math.PI/180,randomRange:(e,t)=>Math.random()*(t-e)+e,angleToString:e=>(e<0&&(e+=t.MathUtils.TAU),t.MathUtils.rad2deg(e).toFixed(2)+"Â°")},t.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)};t.nullTextElement=new class{set innerText(e){}},t.queryParams=(()=>{let e=null;return function(){return null===e&&(e=new Map(window.location.search.substring(1).split("&").map(e=>e.split("=")))),e}})()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const l=n(0);t.Listener={new(e){let t=[];const n={then(e){return l.isFunction(e)&&t.push(e),this},attachTo:function(n,l){return n.addEventListener(l,function(t){return function(n){n.preventDefault(),e(n);for(const e of t)e(n)}}(t)),t=[],n},click:function(e){return n.attachTo(e,"click")}};return n},none:()=>t.Listener.new(()=>void 0)}.freeze()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const l=n(1);t.GameAction={new(e){const t=e;return t.listener=l.Listener.new(e),t.button=document.createElement("button"),t.listener.click(t.button),t}}.freeze(),t.Game={new(e){const n=e.canvas(),l=n.parentElement;n.width=e.size.x,n.height=e.size.y,n.style.border="1px solid black";const r=[],a={name:name,canvas:n,parent:l,tick:0,time:null,delta:0,prevId:null,clearFrame:!0,clear(){n.clear()},start:t.GameAction.new(()=>{c(!0),o.paused=!1,o.running=!0}),stop:t.GameAction.new(()=>{window.cancelAnimationFrame(a.prevId),o.prevId=null,o.time=null,o.paused=!0}),resume:t.GameAction.new(()=>{c(!1),o.paused=!1}),reset:t.GameAction.new(()=>{r.forEach(e=>e.reset(a))}),restart:t.GameAction.new(()=>{a.stop(),a.reset(),a.start()}),running:!1,paused:!1,actors:r,addActor(e){e.reset(a);const t=e;t.game=a,t.actorId=r.length,t.remove=function(){i(e)},r.push(e)}},i=function(e){const t=e.actorId,n=r.pop();t!==r.length&&(r[t]=n);const l=e;l.game=null,l.actorId=null,n.actorId=t},o=a,s=function(e){o.tick++,o.delta=null===a.time?0:e-a.time,o.time=e,function(e){r.forEach(t=>t.update(e))}(a),function(e){e.clearFrame&&e.clear(),r.forEach(t=>t.render(e))}(a),o.prevId=window.requestAnimationFrame(s)},c=function(e){e&&a.reset(),o.prevId||(o.prevId=window.requestAnimationFrame(s),console.log("starting"))};return a}}.freeze()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const l=n(0);t.CanvasCanvas={new(){const e=document.createElement("canvas"),t=e.getContext("2d"),n={get parentElement(){return e.parentElement},get width(){return e.width},set width(t){e.width=t},get height(){return e.height},set height(t){e.height=t},get style(){return e.style},appendTo(t){return t.appendChild(e),this},appendChild:t=>e.appendChild(t),addEventListener(t,n,l){e.addEventListener(t,n,l)},removeEventListener(t,n,l){e.removeEventListener(t,n,l)},dispatchEvent:t=>e.dispatchEvent(t),set fillStyle(e){t.fillStyle=e},set strokeStyle(e){t.strokeStyle=e},clear(){t.clearRect(0,0,e.width,e.height)},fillRect(e,n,l,r,a){let i;a&&(i=t.fillStyle,t.fillStyle=a),t.fillRect(e,n,l,r),i&&(t.fillStyle=i)},fillRectCentered(e,n,l,r,a){this.fillRect(e-.5*l,n-.5*r,l,r,a),t.moveTo(e,n)},fillCircle(e,t,n,l,r){this.fillEllipse(e,t,n,n,l,r)},fillEllipse(e,n,r,a,i,o){let s,c;i&&(s=t.fillStyle,t.fillStyle=i),c&&(c=t.strokeStyle,t.strokeStyle=o),t.beginPath(),t.ellipse(e,n,r,a,0,0,l.MathUtils.TAU),t.fill(),t.beginPath(),s&&(t.fillStyle=s),c&&(t.strokeStyle=c),t.moveTo(e,n)},moveTo(e,n){t.moveTo(e,n)},line(e,n,l,r,a){let i;a&&(i=t.strokeStyle,t.strokeStyle=a),t.moveTo(e,r),t.lineTo(l,r),i&&(t.strokeStyle=i)},lineTo(e,n,l){let r;l&&(r=t.strokeStyle,t.strokeStyle=l),t.lineTo(e,n),r&&(t.strokeStyle=r)},drawImage(e,n,l,r,a){t.drawImage(e,n,l,r,a)}};return Object.freeze(n)}},Object.freeze(t.CanvasCanvas)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const l=n(3),r=n(1),a=n(0),i=n(2);t.BouncingBall={new(e){e.minBounceInterval||(e.minBounceInterval=2);const t=0|e.minBounceInterval,n=+e.radius(),l=function(e,t){const n=+e.x-+t.x,l=+e.y-+t.y;return n*n+l*l},r={ballId:e.id,minBounceInterval:t,radius:n,radiusX:n,radiusY:n,initialSpeed:0,initialAngle:0,x:0,y:0,speed:0,angle:0,lastXBounceTick:0,lastYBounceTick:0,numBounces:0,update:function(e){!function(e){const l=e.canvas,o=+l.width,s=+l.height;let c=+r.x,u=+r.y,d=+r.angle;const p=c<n||c>o-n,f=u<n||u>s-n,m=0|e.tick;m-r.lastXBounceTick>t&&p?(d=-(Math.PI+d)%a.MathUtils.TAU,i.lastXBounceTick=m):m-r.lastYBounceTick>t&&f&&(d=-d,i.lastYBounceTick=m),(p||f)&&i.numBounces++,m%16==0&&(c<0&&(c=n),c>o&&(c=o-n),u<0&&(u=n),u>s&&(u=s-n)),m%64==0&&((c<0||c>o)&&(console.log("super fail safe"),c=o/2),(u<0||u>s)&&(console.log("super fail safe"),u=s/2));const h=+r.speed;c+=h*Math.cos(d)*1,u+=h*Math.sin(d)*1,i.angle=d,i.x=c,i.y=u}(e),function(e){const t=e.balls;for(let e=0|r.ballId;e<(0|t.length);e++){const n=t[e];n.radius,l(r,n)}}(e)},render:function(e){e.canvas.fillCircle(r.x,r.y,n)},reset:function(t){const n=e.velocity();i.initialSpeed=Math.sqrt(n.x*n.x+n.y*n.y),i.initialAngle=Math.atan2(n.y,n.x);const l=e.position();i.x=l.x,i.y=l.y,i.speed=i.initialSpeed,i.angle=i.initialAngle,i.lastXBounceTick=0,i.lastYBounceTick=0,i.numBounces=0}},i=r;return r}}.freeze(),t.BouncingBallsGame={new(e){const n=(e=e.clone()).parent.appendNewElement("center"),l=n.appendDiv();l.appendNewElement("h4").innerText=e.name,l.appendBr();const a=i.Game.new({canvas:e.canvas,name:e.name||"Bouncing Balls",size:e.gameSize}),o=function(n){return t.BouncingBall.new({id:n,minBounceInterval:2,position:e.ballPosition,radius:e.ballRadius,velocity:e.ballVelocity})},s=function(e){const t=e.remove;e.remove=function(){t();const n=e.ballId,l=c.pop();n!==c.length&&(c[n]=l),l.ballId=n,e.ballId=null}},c=new Array(e.numBalls).fill(null).map((e,t)=>o(t));a.balls=c,c.forEach(a.addActor),c.forEach(s),a.addBall=r.Listener.new(()=>{console.log("adding ball");const e=o(c.length);a.addActor(e),s(e),c.push(e)}),a.addBall.click(a.canvas);const u=a.reset;return a.reset=i.GameAction.new(()=>{c.slice(e.numBalls,c.length).reverse().forEach(e=>e.remove()),u()}),a.canvas.appendTo(l),n.appendChild(a.start.button.withInnerText("Start")),n.appendChild(a.stop.button.withInnerText("Pause")),n.appendChild(a.resume.button.withInnerText("Resume")),n.appendChild(a.restart.button.withInnerText("Restart")),a},default(e){const n={x:600,y:600};return t.BouncingBallsGame.new({canvas:l.CanvasCanvas.new,name:"Bouncing Balls",parent:document.body.appendNewElement("div"),gameSize:n,numBalls:e||10,ballRadius:()=>10,ballPosition:function(e,t){return{x:a.MathUtils.randomRange(t,t+e.x),y:a.MathUtils.randomRange(t,t+e.y)}}.bind(null,n,10),ballVelocity:()=>(r=10,i=Math.random()*a.MathUtils.TAU,{x:r*Math.cos(i),y:r*Math.sin(i)})});var r,i},main(){let e=parseInt(a.queryParams().get("numBalls"));(!e||e<0)&&(e=void 0),t.BouncingBallsGame.default(e).start()}}.freeze()},function(e,t){Object.defineProperties(Object,{defineSharedProperties:{writable:!1,enumerable:!1,configurable:!1,value(e,t,n){const l={};for(const e in n)n.hasOwnProperty(e)&&(l[e]=Object.assign({value:n[e]},t));Object.defineProperties(e,l)}}}),Object.defineSharedProperties(Object.prototype,{writable:!1,enumerable:!1,configurable:!1},{freeze(){return Object.freeze(this)},seal(){return Object.seal(this)},clone(){return Object.assign({},this)}}),Element.prototype.clearHTML=function(){this.innerHTML=""},Element.prototype.setAttributes=function(e){for(const t in e)e.hasOwnProperty(t)&&e[t]&&this.setAttribute(t,e[t].toString())},HTMLElement.prototype.appendNewElement=function(e){return this.appendChild(document.createElement(e))},HTMLElement.prototype.appendDiv=function(){return this.appendNewElement("div")},HTMLElement.prototype.appendButton=function(e){const t=this.appendNewElement("button");return t.innerText=e,t},HTMLElement.prototype.appendBr=function(){return this.appendNewElement("br")},HTMLElement.prototype.withInnerText=function(e){return this.innerText=e,this}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(5),n(4).BouncingBallsGame.main()}]);